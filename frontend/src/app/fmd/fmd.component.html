<app-header [breadcrumb]="breadcrumb"></app-header>

<div class="row justify-content-center content">
  <div class="col-12 col-md-10 col-lg-8 p-0 m-0">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ title }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-tab-group>
          <mat-tab label="Übersicht">
            <!-- Grafiken und Zahlen -->
          </mat-tab>
          <mat-tab label="ATS Träger">
            <form
              [formGroup]="formAuswahl"
              (ngSubmit)="auswahlBearbeiten()"
              [hidden]="!formModul.disabled"
            >
              <section class="row mt-3 mb-3 mx-0">
                <div class="col-12 col-lg-9">
                  <mat-form-field>
                    <mat-label>Mitglied auswählen</mat-label>
                    <mat-select formControlName="atstraeger">
                      @for (opt of atstraeger; track opt) {
                      <mat-option [value]="opt.id">
                        {{ opt.stbnr }} - {{ opt.vorname }} {{ opt.nachname }}</mat-option
                      >
                      }
                    </mat-select>
                  </mat-form-field>
                </div>
                <div
                  class="col-6 col-lg-3 m-0 row align-items-center auswahl-button"
                >
                  <button
                    type="submit"
                    mat-raised-button
                    class="col-auto"
                    color="primary"
                    [disabled]="!formAuswahl.controls['atstraeger'].value"
                  >
                    Auswahl bearbeiten
                  </button>
                </div>
              </section>
            </form>
            <button
              mat-raised-button
              color="accent"
              class="me-2 mb-3"
              [hidden]="!formModul.disabled"
              (click)="neueDetails()"
              type="button"
            >
              Hinzufügen
            </button>
            <form
              [formGroup]="formModul"
              (ngSubmit)="datenSpeichern()"
              [hidden]="formModul.disabled"
            >
              <input
                hidden
                type="text"
                class="form-control"
                formControlName="id"
              />
              <input
                hidden
                type="text"
                class="form-control"
                formControlName="id"
              />
              <button
                mat-raised-button
                color="accent"
                class="me-3 mt-3 mb-3"
                [hidden]="!formModul.valid"
                type="submit"
              >
                Daten speichern
              </button>
              <button
                mat-raised-button
                class="mt-3 mb-3"
                color="primary"
                [hidden]="formModul.disabled"
                type="button"
                (click)="abbrechen()"
              >
                Abbrechen
              </button>
              <section class="row mt-2 mx-0">
                <div class="col-12 col-lg-12 mb-3">
                  <mat-form-field>
                    <mat-label>Mitglied auswählen</mat-label>
                    <mat-select formControlName="mitglied_id">
                      @for (opt of mitglieder; track opt) {
                      <mat-option [value]="opt.pkid">
                        {{ opt.stbnr }} - {{ opt.vorname }} {{ opt.nachname }}</mat-option
                      >
                      }
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-8 mb-3">
                  <mat-form-field>
                    <mat-label>Hausarzt</mat-label>
                    <input matInput type="text" formControlName="hausarzt" />
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-4 mb-3">
                  <mat-form-field>
                    <mat-label>Tauchlichkeit</mat-label>
                    <input
                      matInput
                      type="text"
                      formControlName="tauglichkeit"
                    />
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-4 mb-3">
                  <mat-form-field>
                    <mat-label>Letzte Untersuchung</mat-label>
                    <input
                      matInput
                      type="text"
                      formControlName="letzte_untersuchung"
                    />
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-4 mb-3">
                  <mat-form-field>
                    <mat-label>Leistungstest</mat-label>
                    <input
                      matInput
                      type="text"
                      formControlName="leistungstest"
                    />
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-4 mb-3">
                  <mat-form-field>
                    <mat-label>Nächste Untersuchung</mat-label>
                    <input
                      matInput
                      type="text"
                      formControlName="naechste_untersuchung"
                    />
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-12 mb-3">
                  <mat-form-field>
                    <mat-label>Notizen</mat-label>
                    <input matInput type="text" formControlName="notizen" />
                  </mat-form-field>
                </div>
                <div class="col-12 col-lg-4 mb-3">
                  <mat-form-field>
                    <mat-label>FDISK Update</mat-label>
                    <input
                      matInput
                      type="text"
                      formControlName="fdisk_aenderung"
                      placeholder="TT.MM.YYYY"
                    />
                    @if
                    (formModul.controls['fdisk_aenderung'].hasError('pattern'))
                    {
                    <mat-error
                      >Ungültiges Format. Bitte TT.MM.YYYY eingeben.</mat-error
                    >
                    } @if
                    (formModul.controls['fdisk_aenderung'].hasError('dateInvalid'))
                    {
                    <mat-error>Kein existierendes Datum!</mat-error>
                    }
                  </mat-form-field>
                </div>
              </section>

              <button
                mat-raised-button
                color="warn"
                [hidden]="!formModul.controls['id'].value"
                type="button"
                (click)="datenLoeschen()"
              >
                Daten löschen
              </button>
            </form>
          </mat-tab>
          <mat-tab label="Untersuchungen">
            <!-- Liste Finnentest -->
          </mat-tab>
          <mat-tab label="Finnentest">
            <!-- Liste Finnentest -->
          </mat-tab>
          <mat-tab label="Tauglichkeit">
            <!-- Liste Tauchlichkeiten -->
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>
</div>
